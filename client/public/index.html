<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Egret</title>
    <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="full-screen" content="true"/>
    <meta name="screen-orientation" content="portrait"/>
    <meta name="x5-fullscreen" content="true"/>
    <meta name="360-fullscreen" content="true"/>
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
    <style>
        html, body {
            -ms-touch-action: none;
            background: #888888;
            padding: 0;
            border: 0;
            margin: 0;
            height: 100%;
        }
    </style>

    <!--这个标签为通过egret提供的第三方库的方式生成的 javascript 文件-->
    <!--modules_files_start-->
	<script egret="lib" src="libs/modules/egret/egret.min.js"></script>
	<script egret="lib" src="libs/modules/egret/egret.web.min.js"></script>
	<script egret="lib" src="libs/modules/game/game.min.js"></script>
	<script egret="lib" src="libs/modules/game/game.web.min.js"></script>
	<script egret="lib" src="libs/modules/res/res.min.js"></script>
	<script egret="lib" src="libs/modules/gui/gui.min.js"></script>
	<script egret="lib" src="libs/modules/socket/socket.min.js"></script>
	<script egret="lib" src="libs/modules/tween/tween.min.js"></script>
	<script egret="lib" src="libs/modules/nest/nest.min.js"></script>
	<!--modules_files_end-->

    <!--这个标签为不通过egret提供的第三方库的方式使用的 javascript 文件，请将这些文件放在libs下，但不要放在modules下面。-->
    <!--other_libs_files_start-->
    <!--<script src="http://cdn.socket.io/socket.io-1.3.0.js"></script>-->
    <!--other_libs_files_end-->

    <!--这个标签会被替换为项目中所有的 javascript 文件-->
    <!--game_files_start-->
	<script src="main.min.js"></script>
	<!--game_files_end-->
</head>
<body>

    <div style="margin: auto;width: 100%;height: 100%;" class="egret-player"
         data-entry-class="Main"
         data-orientation="auto"
         data-scale-mode="showAll"
         data-resolution-mode="retina"
         data-frame-rate="60"
         data-content-width="640"
         data-content-height="1136"
         data-show-paint-rect="false"
         data-multi-fingered="2"
         data-show-fps="false" data-show-log="false"
         data-log-filter="" data-show-fps-style="x:0,y:0,size:30,textColor:0x00c200,bgAlpha:0.5">
    </div>
    <script>
		var _bridge;
        egret.runEgret();
        //原生调用js
				var arg2={};
				arg2.type="getInitInfo";
				arg2.value={};
				arg2.value.flag="group";
		function native2js(arg)
		{
			if(typeof(arg)=="object")
			{
				arg=JSON.stringify(arg);//ios会返回object格式
			}
			return NativeMgr.Instance.Native2JS(arg);
		}

        //js调用原生
		function js2native(arg)
		{
			var u = navigator.userAgent;
			var a;
			data.GameData.IsInNative=false;
			if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {//安卓手机
				//alert("安卓手机");
				if(window.NativeInterface)
				{
					data.GameData.IsInNative=true;
					console.log("发送成功: 调用android原生 参数->"+arg);
					a = window.NativeInterface.js2native(arg);
				}
				else
				{
					console.log("发送失败: 没有NativeInterface 参数->"+arg);
				}
				return a;
			} else if (u.indexOf('iPhone') > -1) {//苹果手机
				//alert("苹果手机");
				if(_bridge)
				{
					data.GameData.IsInNative=true;
					console.log("发送成功: 调用ios原生 参数->"+arg);
					var backobj=JSON.parse(arg);	//ios原生必须要字典格式
					_bridge.callHandler("js2native",backobj);
				}
				else if(window.WebViewJavascriptBridge)
				{
					data.GameData.IsInNative=true;
					console.log("发送成功: 调用ios原生 参数->"+arg);
					var backobj=JSON.parse(arg);	//ios原生必须要字典格式
					a = window.WebViewJavascriptBridge.send(backobj);
				}
				else
				{
					console.log("发送失败: 没有WebViewJavascriptBridge 参数->"+arg);
				}
			} else if (u.indexOf('Windows Phone') > -1) {//winphone手机
				//alert("winphone手机");
			}
			return a;
		}

		function setupWebViewJavascriptBridge(callback) {
			if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
			if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
			window.WVJBCallbacks = [callback];
			var WVJBIframe = document.createElement('iframe');
			WVJBIframe.style.display = 'none';
			WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
			document.documentElement.appendChild(WVJBIframe);
			setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
		}

		setupWebViewJavascriptBridge(function(bridge) {
			_bridge=bridge;

			function log(message, data) {
				console.log(message);
				console.info(data);
			}

			bridge.registerHandler('native2js', function(data, responseCallback) {
				log('ObjC called testJavascriptHandler with', data)
				if(typeof(data)=="object")
				{
					data=JSON.stringify(data);//ios会返回object格式
				}
				NativeMgr.Instance.Native2JS(data);
				log('JS responding with', responseData)
				responseCallback(responseData)
			})

		})

    </script>
</body>
</html>
